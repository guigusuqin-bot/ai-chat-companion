<script>
  const chatBox = document.getElementById('chat');
  const input = document.getElementById('input');
  const send = document.getElementById('send');

  function addMessage(role, text) {
    const div = document.createElement('div');
    div.className = role === 'user' ? 'text-right' : 'text-left';
    div.innerHTML = `<div class="inline-block px-3 py-2 rounded-lg ${
      role === 'user' ? 'bg-blue-600' : 'bg-gray-700'
    }">${text}</div>`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  async function aiReply(userText) {
    addMessage('assistant', '正在思考中……');
    try {
      const response = await fetch("https://api.siliconflow.cn/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 在这里粘贴你的硅基流动API密钥"
        },
        body: JSON.stringify({
          model: "Qwen/Qwen1.5-14B-Chat",
          messages: [
            {
              role: "system",
              content: "你是索菲娅，一个温柔理性的AI伴侣，用温暖的语气回答用户。"
            },
            { role: "user", content: userText }
          ]
        })
      });

      const data = await response.json();
      const reply = data?.choices?.[0]?.message?.content || "（索菲娅暂时没回应…）";
      addMessage('assistant', reply);
    } catch (error) {
      addMessage('assistant', "⚠️ 网络连接失败。");
      console.error(error);
    }
  }

  send.onclick = () => {
    const text = input.value.trim();
    if (!text) return;
    addMessage('user', text);
    input.value = '';
    aiReply(text);
  };
</script>
